{"version":3,"sources":["player.js"],"names":["const","lsKeys","page","urlPrefix","urlIdentifier","urlInput","document","querySelector","reloadBtn","downloadBtn","uploadRoot","titleFormat","videoContainer","player","window","HELP_IMPROVE_VIDEOJS","onError","error","console","content","createElement","innerHTML","toString","swal","title","icon","onAxiosError","statusText","response","status","description","data","toggleReloadBtn","enabled","classList","remove","removeAttribute","add","setAttribute","reloadVideo","value","src","axios","head","then","includes","type","headers","isvideo","startsWith","isaudio","dispose","videoElement","id","className","appendChild","options","language","playbackRates","responsive","plugins","wavesurfer","backend","videojs","let","message","getPluginVersion","WaveSurfer","log","seekButtons","forward","back","replace","history","pushState","catch","addEventListener","mainScript","dataset","location","protocol","host","match","pathname","substring","indexOf","form","event","preventDefault","checkValidity"],"mappings":"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","file":"player.js","sourcesContent":["/* global swal, axios, videojs, WaveSurfer */\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nconst lsKeys = {}\r\n\r\n// eslint-disable-next-line no-unused-vars\r\nconst page = {\r\n  urlPrefix: null,\r\n  urlIdentifier: null,\r\n\r\n  urlInput: document.querySelector('#identifier'),\r\n  reloadBtn: document.querySelector('#reloadBtn'),\r\n  downloadBtn: document.querySelector('#downloadBtn'),\r\n  uploadRoot: null,\r\n  titleFormat: null,\r\n\r\n  videoContainer: document.querySelector('#playerContainer'),\r\n  player: null\r\n}\r\n\r\n// Disable video.js telemetry (should already be disabled by default since v7 though)\r\nwindow.HELP_IMPROVE_VIDEOJS = false\r\n\r\n// Handler for regular JS errors\r\npage.onError = error => {\r\n  console.error(error)\r\n\r\n  const content = document.createElement('div')\r\n  content.innerHTML = `\r\n    <p><code>${error.toString()}</code></p>\r\n    <p>Please check your console for more information.</p>\r\n  `\r\n  return swal({\r\n    title: 'An error occurred!',\r\n    icon: 'error',\r\n    content\r\n  })\r\n}\r\n\r\n// Handler for Axios errors\r\npage.onAxiosError = error => {\r\n  // Better Cloudflare errors\r\n  const cloudflareErrors = {\r\n    520: 'Unknown Error',\r\n    521: 'Web Server Is Down',\r\n    522: 'Connection Timed Out',\r\n    523: 'Origin Is Unreachable',\r\n    524: 'A Timeout Occurred',\r\n    525: 'SSL Handshake Failed',\r\n    526: 'Invalid SSL Certificate',\r\n    527: 'Railgun Error',\r\n    530: 'Origin DNS Error'\r\n  }\r\n\r\n  const statusText = cloudflareErrors[error.response.status] || error.response.statusText\r\n\r\n  const description = error.response.data && error.response.data.description\r\n    ? error.response.data.description\r\n    : ''\r\n  return swal(`${error.response.status} ${statusText}`, description, 'error')\r\n}\r\n\r\npage.toggleReloadBtn = enabled => {\r\n  if (enabled) {\r\n    page.reloadBtn.classList.remove('is-loading')\r\n    page.reloadBtn.removeAttribute('disabled')\r\n  } else {\r\n    page.reloadBtn.classList.add('is-loading')\r\n    page.reloadBtn.setAttribute('disabled', 'disabled')\r\n  }\r\n}\r\n\r\npage.reloadVideo = () => {\r\n  if (!page.urlInput.value) return\r\n\r\n  page.toggleReloadBtn(false)\r\n  const src = `${page.uploadRoot}/${page.urlInput.value}`\r\n\r\n  axios.head(src).then(response => {\r\n    if (![200, 304].includes(response.status)) {\r\n      page.toggleReloadBtn(true)\r\n      return page.onAxiosError(response)\r\n    }\r\n\r\n    const type = response.headers['content-type'] || ''\r\n    const isvideo = type.startsWith('video/')\r\n    const isaudio = type.startsWith('audio/')\r\n    if (!isvideo && !isaudio) {\r\n      page.toggleReloadBtn(true)\r\n      return swal('An error occurred!', 'The requested upload does not appear to be a media file.', 'error')\r\n    }\r\n\r\n    page.urlIdentifier = page.urlInput.value\r\n\r\n    if (page.player) {\r\n      page.player.dispose()\r\n      page.videoContainer.innerHTML = ''\r\n    }\r\n\r\n    const videoElement = document.createElement('video-js')\r\n    videoElement.id = 'video-js'\r\n    videoElement.className = 'video-js vjs-default-skin vjs-fluid vjs-big-play-centered'\r\n    videoElement.setAttribute('controls', true)\r\n    videoElement.setAttribute('preload', 'auto')\r\n\r\n    page.videoContainer.appendChild(videoElement)\r\n\r\n    const options = {\r\n      language: 'en',\r\n      playbackRates: [0.25, 0.5, 0.75, 1, 1.25, 1.5, 1.75, 2],\r\n      responsive: true\r\n    }\r\n\r\n    if (isaudio) {\r\n      options.plugins = {\r\n        wavesurfer: {\r\n          backend: 'MediaElement'\r\n        }\r\n      }\r\n    }\r\n\r\n    page.player = videojs('video-js', options, () => {\r\n      let message = `Using video.js ${videojs.VERSION}`\r\n      if (isaudio) {\r\n        message += `with videojs-wavesurfer ${videojs.getPluginVersion('wavesurfer')} and wavesurfer.js ${WaveSurfer.VERSION}`\r\n      }\r\n      videojs.log(message)\r\n      page.player.src({ src, type })\r\n    })\r\n    page.player.seekButtons({ forward: 10, back: 10 })\r\n\r\n    if (page.titleFormat) {\r\n      document.title = page.titleFormat.replace(/%identifier%/g, page.urlIdentifier)\r\n    }\r\n\r\n    if (page.downloadBtn) {\r\n      page.downloadBtn.setAttribute('href', src)\r\n    }\r\n\r\n    window.history.pushState(null, null, page.urlPrefix + page.urlIdentifier)\r\n    page.toggleReloadBtn(true)\r\n  }).catch(error => {\r\n    page.toggleReloadBtn(true)\r\n    if (typeof error.response !== 'undefined') page.onAxiosError(error)\r\n    else page.onError(error)\r\n  })\r\n}\r\n\r\nwindow.addEventListener('DOMContentLoaded', () => {\r\n  const mainScript = document.querySelector('#mainScript')\r\n  if (!mainScript || typeof mainScript.dataset.uploadRoot === 'undefined') return\r\n\r\n  page.uploadRoot = mainScript.dataset.uploadRoot\r\n  page.titleFormat = mainScript.dataset.titleFormat\r\n\r\n  let urlPrefix = window.location.protocol + '//' + window.location.host\r\n  const match = window.location.pathname.match(/.*\\/(.*)$/)\r\n  if (!match || !match[1]) {\r\n    return swal('An error occurred!', 'Failed to parse upload identifier from URL.', 'error')\r\n  }\r\n\r\n  page.urlIdentifier = match[1]\r\n  urlPrefix += window.location.pathname.substring(0, window.location.pathname.indexOf(match[1]))\r\n  page.urlPrefix = urlPrefix\r\n\r\n  if (!page.urlInput) return\r\n  page.urlInput.value = page.urlIdentifier\r\n\r\n  // Prevent default form's submit actio\r\n  const form = document.querySelector('#inputForm')\r\n  form.addEventListener('submit', event => {\r\n    event.preventDefault()\r\n  })\r\n\r\n  if (!page.videoContainer) return\r\n\r\n  page.reloadBtn = document.querySelector('#reloadBtn')\r\n  if (page.reloadBtn) {\r\n    page.reloadBtn.addEventListener('click', event => {\r\n      if (!form.checkValidity()) return\r\n      page.reloadVideo()\r\n    })\r\n  }\r\n\r\n  page.reloadVideo()\r\n})\r\n"]}